#Hembras ML
females.est.ML=lme2(data = Data_females,n_0=n_0Females,method="ML")
females.jk.ML=jk(data=Data_females,n_0=n_0Females,method="ML",funcion = "lme")
females.ML=cbind(females.est.ML,females.jk.ML)
#Hembras REML
females.est.REML=lme2(data = Data_females,n_0=n_0Females,method="REML")
females.jk.REML=jk(data=Data_females,n_0=n_0Females,method="REML",funcion="lme")
females.REML=cbind(females.est.REML,females.jk.REML)
#### Aplica funciones machos ####
#Machos Ancova
males.ancova=ancova(data = Data_males,n_0=n_0Males)
males.jk.ancova=jk(data=Data_males,n_0=n_0Males,funcion = "ancova")
males.ancova=cbind(males.ancova,males.jk.ancova)
#Machos ML
males.est.ML=lme2(data = Data_males,n_0=n_0Males,method="ML")
males.jk.ML=jk(data=Data_males,n_0=n_0Males,method="ML",funcion="lme")
males.ML=cbind(males.est.ML,males.jk.ML)
#Machos REML
males.est.REML=lme2(data = Data_males,n_0=n_0Males,method="REML")
males.jk.REML=jk(data=Data_males,n_0=n_0Males,method="REML",funcion="lme")
males.REML=cbind(males.est.REML,males.jk.REML)
# combine
ancova <- cbind(females.ancova, males.ancova)
ML     <- cbind(females.ML, males.ML)
REML   <- cbind(females.REML, males.REML)
names(ancova)
colnames(ancova) <- c("Female_estimate", "Females_Jacknife", "Females_low_95%_CI", "Females_up_95%_CI",
"Males_estimate", "Males_Jacknife", "Males_low_95%_CI", "Males_up_95%_CI")
ancova$Method <- "Anova"
names(ML)
colnames(ML) <- c("Female_estimate", "Females_Jacknife", "Females_low_95%_CI", "Females_up_95%_CI",
"Males_estimate", "Males_Jacknife", "Males_low_95%_CI", "Males_up_95%_CI")
ML$Method <- "ML"
names(REML)
colnames(REML) <- c("Female_estimate", "Females_Jacknife", "Females_low_95%_CI", "Females_up_95%_CI",
"Males_estimate", "Males_Jacknife", "Males_low_95%_CI", "Males_up_95%_CI")
REML$Method <- "REML"
# Combine and export to csv
Table_1 <- rbind(ancova, ML, REML)
# Define the desired order of column names
Table_1 <- c("Method", "Female_estimate", "Females_Jacknife", "Females_low_95%_CI", "Females_up_95%_CI",
"Males_estimate", "Males_Jacknife", "Males_low_95%_CI", "Males_up_95%_CI")
Table_1 <- Table_1[, Table_1]
# Combine and export to csv
Table_1 <- rbind(ancova, ML, REML)
View(Table_1)
# Combine and export to csv
Table_1 <- rbind(ancova, ML, REML)
write.csv(Table_1, "Estimates of variance-covariance components and broad-sense heritability DGRP lines.csv", row.names = TRUE)
# ------------------------------------------------------------------------------
# Script to calculate survival probabilities of DGRP lines under normoxia
# Data generated by Felix P Leiva (e-mail: felixpleiva@gmail.com)
# Script created by Felix P Leiva (e-mail: felixpleiva@gmail.com)
# Cite as:
# Leiva FP, Santos M, Rezende EL, & Verberk WCEP. (2024). Paper data and code
# for: Genetic variation of heat tolerance in a model ectotherm: an approach
# using thermal death times curves. Zenodo. DOI will be available here
# Cleaning working space
rm(list=ls())
# check directory
getwd()
# Libraries
library(dplyr)
# ------------------------------------------------------------------------------
#Load data of the 20 DGRP lines
all.lines.21<-read.csv("../Outputs/0.1.1. Survival time of Drosophila melanogaster across DGRP lines.csv")
#stock as factor
str(all.lines.21)
all.lines.21$stock<-as.factor(all.lines.21$stock)
#transform minutes in log10-scale to minutes
all.lines.21$surv.time2<-as.numeric(10^(all.lines.21$surv.time))
# subset by sex
data_f<-subset(all.lines.21,sex=="female") #females
data_m<-subset(all.lines.21,sex=="male") #males
# mean and sd of survival time by sex
all.lines.21 %>%
group_by(test.temp, sex) %>%
summarise(
mean_survival_time = round(mean(surv.time2), 3),
sd_survival_time = round(sd(surv.time2), 3)
)
# mean and sd of survival time sex pooled
all.lines.21 %>%
group_by(test.temp) %>%
summarise(
mean_survival_time = round(mean(surv.time2), 3),
sd_survival_time = round(sd(surv.time2), 3)
)
#-------------------------------------------------------------------------------
# subset by stock
levels(data_f$stock)
# [1] "25180" "25182" "25190" "25192" "25198" "25201" "25203" "28135" "28141" "28153"
# [11] "28173" "28180" "28191" "28196" "28197" "28198" "28247" "28248" "28258" "29652"
# FEMALES
f.25180<-subset(data_f,stock=="25180")
f.25182<-subset(data_f,stock=="25182")
f.25190<-subset(data_f,stock=="25190")
f.25192<-subset(data_f,stock=="25192")
f.25198<-subset(data_f,stock=="25198")
f.25201<-subset(data_f,stock=="25201")
f.25203<-subset(data_f,stock=="25203")
f.28135<-subset(data_f,stock=="28135")
f.28141<-subset(data_f,stock=="28141")
f.28153<-subset(data_f,stock=="28153")
f.28173<-subset(data_f,stock=="28173")
f.28180<-subset(data_f,stock=="28180")
f.28191<-subset(data_f,stock=="28191")
f.28196<-subset(data_f,stock=="28196")
f.28197<-subset(data_f,stock=="28197")
f.28198<-subset(data_f,stock=="28198")
f.28247<-subset(data_f,stock=="28247")
f.28248<-subset(data_f,stock=="28248")
f.28258<-subset(data_f,stock=="28258")
f.29652<-subset(data_f,stock=="29652")
# MALES
m.25180<-subset(data_m,stock=="25180")
m.25182<-subset(data_m,stock=="25182")
m.25190<-subset(data_m,stock=="25190")
m.25192<-subset(data_m,stock=="25192")
m.25198<-subset(data_m,stock=="25198")
m.25201<-subset(data_m,stock=="25201")
m.25203<-subset(data_m,stock=="25203")
m.28135<-subset(data_m,stock=="28135")
m.28141<-subset(data_m,stock=="28141")
m.28153<-subset(data_m,stock=="28153")
m.28173<-subset(data_m,stock=="28173")
m.28180<-subset(data_m,stock=="28180")
m.28191<-subset(data_m,stock=="28191")
m.28196<-subset(data_m,stock=="28196")
m.28197<-subset(data_m,stock=="28197")
m.28198<-subset(data_m,stock=="28198")
m.28247<-subset(data_m,stock=="28247")
m.28248<-subset(data_m,stock=="28248")
m.28258<-subset(data_m,stock=="28258")
m.29652<-subset(data_m,stock=="29652")
par(mfrow=c(1,2),tcl=-0.4, family="serif",omi=c(0,0,0,0))
#females
# labels
labs= c("1","2","5","10","30","120","420")
xs= log10(c(1, 2, 5, 10, 30, 60*2, 60*7))
#TDT curves
par(mai=c(0.9, 0.9, 0.1, 0.1))
plot(surv.time ~ jitter(test.temp,0.5),xlim=c(35.6,39.4),ylim=c(0,3),cex.axis=1.2, cex.lab=1.4,yaxt="n",cex=1.4,pch=16,
col="#4DAC2660",xlab="Test temperature (ºC)",ylab="Time (min)",
data=f.25180)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25182)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25190)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25192)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25198)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25201)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25203)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28135)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28141)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28153)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28173)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28180)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28191)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28196)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28197)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28198)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28247)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28248)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28258)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.29652)
abline(lm(surv.time ~ test.temp,data = f.25180),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25182),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25190),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25192),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25198),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25201),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25203),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28135),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28141),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28153),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28173),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28180),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28191),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28196),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28197),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28198),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28247),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28248),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28258),col="gray")
abline(lm(surv.time ~ test.temp,data = f.29652),col="gray")
abline(lm(surv.time ~ test.temp,data = data_f),col="#4DAC26",lwd=3)
text(37.5,2.9,"Inbred lines",col="gray",adj=0,font=2,cex=1.2)
text(37.5,2.7,"Inbred lines pooled",adj=0,col="#4DAC26",font=2,cex=1.2)
text(36.0, 0.3, "\u2640", col = "#4DAC26", adj = 0, font = 2, cex = 3) # Female symbol
#update axis
axis(2, at=xs, labels=labs, cex.axis=1.2)
par(mai=c(0.55,0.6,0.1,0.1))
#-----------------------------------------------------------------------------
#males
# labels
labs= c("1","2","5","10","30","120","420")
xs= log10(c(1,2,5,10,30,60*2,60*7))
par(mai=c(0.9, 0.9, 0.1, 0.1))
plot(surv.time ~ jitter(test.temp,0.5),xlim=c(35.6,39.4),ylim=c(0,3),yaxt="n",
cex.axis=1.2, cex.lab=1.4,cex=1.4,pch=16,col="#A6761D70",
xlab="Test temperature (ºC)",ylab="Time (min)",
data=m.25180)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25182)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25190)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25192)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25198)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25201)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25203)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28135)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28141)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28153)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28173)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28180)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28191)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28196)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28197)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28198)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28247)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28248)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28258)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.29652)
abline(lm(surv.time ~ test.temp,data = m.25180),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25182),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25190),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25192),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25198),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25201),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25203),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28135),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28141),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28153),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28173),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28180),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28191),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28196),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28197),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28198),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28247),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28248),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28258),col="gray")
abline(lm(surv.time ~ test.temp,data = m.29652),col="gray")
abline(lm(surv.time ~ test.temp,data = data_m),col="#A6761D",lwd=3)
text(37.5,2.9,"Inbred lines",col="gray",adj=0,font=2,cex=1.2)
text(37.5,2.7,"Inbred lines pooled",adj=0,col="#A6761D",font=2,cex=1.2)
text(36.0, 0.3, "\u2642", col = "#A6761D", adj = 0, font = 2, cex = 3) # Male symbol
#update axis
axis(2, at=xs, labels=labs, cex.axis=1.2)
# close device
dev.off()
jpg("../Outputs/Figure_1_Thermal_death_time_curves_DGRP_lines.jpg",width = 10,height = 5,units = "in",res = 600)
jpg("../Outputs/Figure_1_Thermal_death_time_curves_DGRP_lines.jpeg",width = 10,height = 5,units = "in",res = 600)
jpeg("../Outputs/Figure_1_Thermal_death_time_curves_DGRP_lines.jpeg",width = 10,height = 5,units = "in",res = 600)
par(mfrow=c(1,2),tcl=-0.4, family="serif",omi=c(0,0,0,0))
#females
# labels
labs= c("1","2","5","10","30","120","420")
xs= log10(c(1, 2, 5, 10, 30, 60*2, 60*7))
#TDT curves
par(mai=c(0.9, 0.9, 0.1, 0.1))
plot(surv.time ~ jitter(test.temp,0.5),xlim=c(35.6,39.4),ylim=c(0,3),cex.axis=1.2, cex.lab=1.4,yaxt="n",cex=1.4,pch=16,
col="#4DAC2660",xlab="Test temperature (ºC)",ylab="Time (min)",
data=f.25180)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25182)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25190)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25192)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25198)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25201)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.25203)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28135)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28141)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28153)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28173)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28180)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28191)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28196)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28197)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28198)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28247)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28248)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.28258)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#4DAC2660",data=f.29652)
abline(lm(surv.time ~ test.temp,data = f.25180),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25182),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25190),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25192),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25198),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25201),col="gray")
abline(lm(surv.time ~ test.temp,data = f.25203),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28135),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28141),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28153),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28173),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28180),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28191),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28196),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28197),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28198),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28247),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28248),col="gray")
abline(lm(surv.time ~ test.temp,data = f.28258),col="gray")
abline(lm(surv.time ~ test.temp,data = f.29652),col="gray")
abline(lm(surv.time ~ test.temp,data = data_f),col="#4DAC26",lwd=3)
text(37.5,2.9,"Inbred lines",col="gray",adj=0,font=2,cex=1.2)
text(37.5,2.7,"Inbred lines pooled",adj=0,col="#4DAC26",font=2,cex=1.2)
text(36.0, 0.3, "\u2640", col = "#4DAC26", adj = 0, font = 2, cex = 3) # Female symbol
#update axis
axis(2, at=xs, labels=labs, cex.axis=1.2)
par(mai=c(0.55,0.6,0.1,0.1))
#-----------------------------------------------------------------------------
#males
# labels
labs= c("1","2","5","10","30","120","420")
xs= log10(c(1,2,5,10,30,60*2,60*7))
par(mai=c(0.9, 0.9, 0.1, 0.1))
plot(surv.time ~ jitter(test.temp,0.5),xlim=c(35.6,39.4),ylim=c(0,3),yaxt="n",
cex.axis=1.2, cex.lab=1.4,cex=1.4,pch=16,col="#A6761D70",
xlab="Test temperature (ºC)",ylab="Time (min)",
data=m.25180)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25182)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25190)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25192)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25198)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25201)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.25203)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28135)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28141)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28153)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28173)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28180)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28191)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28196)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28197)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28198)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28247)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28248)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.28258)
points(surv.time ~ jitter(test.temp,0.5),cex=1.4,pch=16,col="#A6761D70",data=m.29652)
abline(lm(surv.time ~ test.temp,data = m.25180),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25182),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25190),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25192),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25198),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25201),col="gray")
abline(lm(surv.time ~ test.temp,data = m.25203),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28135),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28141),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28153),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28173),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28180),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28191),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28196),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28197),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28198),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28247),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28248),col="gray")
abline(lm(surv.time ~ test.temp,data = m.28258),col="gray")
abline(lm(surv.time ~ test.temp,data = m.29652),col="gray")
abline(lm(surv.time ~ test.temp,data = data_m),col="#A6761D",lwd=3)
text(37.5,2.9,"Inbred lines",col="gray",adj=0,font=2,cex=1.2)
text(37.5,2.7,"Inbred lines pooled",adj=0,col="#A6761D",font=2,cex=1.2)
text(36.0, 0.3, "\u2642", col = "#A6761D", adj = 0, font = 2, cex = 3) # Male symbol
#update axis
axis(2, at=xs, labels=labs, cex.axis=1.2)
# close device
dev.off()
# Cleaning working space
rm(list=ls())
set.seed(42)
# check directory
getwd()
# ------------------------------------------------------------------------------
#Libraries
library(car)
library(lme4)
library(MuMIn)
library(dplyr)
library(nlme)
# +++++++++++++++++++++++++++++++++++++++
#### Load data of the 20 DGRP lines ####
all.lines.21<-read.csv("../Outputs/0.1.1. Survival time of Drosophila melanogaster across DGRP lines.csv")
# check data structure
str(all.lines.21)
#stock as factor
all.lines.21$stock<-as.factor(all.lines.21$stock)
#transform minutes in log10-scale to minutes
all.lines.21$surv.time2<-as.numeric(10^(all.lines.21$surv.time))
# subset by sex
names(all.lines.21)[c(14,5,2)]=c("Survtime","Testtemp","Genotype")
Data_females<-subset(all.lines.21,sex=="female") #females
Data_males<-subset(all.lines.21,sex=="male") #males
n_0Females <- 10.2479840885613
n_0Males = 10.8054730372430
#### Ancova ####
ancova=function(data,n_0){
ancova1=lm(Survtime ~ -1+Genotype/Testtemp, data = data)
# Extract coefficients
coefficients <- summary(ancova1)$coefficients
# Intercepts and slopes
intercepts <- coefficients[1:length(unique(data$Genotype)), "Estimate"]
slopes <- coefficients[(length(unique(data$Genotype))+1):(length(unique(data$Genotype))*2), "Estimate"]
Mean_b0 = mean(intercepts); Mean_b1 = mean(slopes);
# Calculos
vr=matrix(c(var(intercepts),rep(cov(intercepts,slopes),2),var(slopes)),nr=2)
# Replicando a Mauro
Mean_b0F = mean(intercepts); Mean_b1F = mean(slopes);
Var_b0F = as.numeric(vr[1,1]); Var_b1F = as.numeric(vr[2,2]);
Cov_b0F_b1F = as.numeric(vr[2,1])
Var_eF = sigma(ancova1)^2;
# Calculate variance components
Var_CTmaxF <- ((Mean_b0F)^2 / (Mean_b1F)^2) *
(Var_b0F/(Mean_b0F)^2 - (2 * Cov_b0F_b1F / (Mean_b0F * Mean_b1F)) + Var_b1F/(Mean_b1F)^2)
Var_zF <- Var_b1F / (Mean_b1F)^4
# Calculate heritability estimates
n_0
H2_CTmaxF <- Var_CTmaxF / (Var_CTmaxF + Var_zF + Var_eF / n_0)
H2_zF <- Var_zF / (Var_CTmaxF + Var_zF + Var_eF / n_0)
as.data.frame(t(data.frame(Var_b0F, Var_b1F, Cov_b0F_b1F, Var_eF, Var_CTmaxF, Var_zF, H2_CTmaxF, H2_zF)))
}
#### Funcion LME ####
lme2=function(data,n_0,method){
#1. All data estimates
lme.f <- lme(Survtime ~ Testtemp,random=list(~Testtemp|Genotype,~1|Genotype), data = data, method=method,control = lmeControl(maxiter=1000) )
(vr=VarCorr(lme.f))
# Replicando a Mauro
Mean_b0F = fixef(lme.f)[1]; Mean_b1F = fixef(lme.f)[2];
Var_b0F = as.numeric(vr[2,1]); Var_b1F = as.numeric(vr[3,1]);
Cov_b0F_b1F = as.numeric(vr[2,2])*as.numeric(vr[3,2])*as.numeric(vr[3,3])
Var_eF = sigma(lme.f)^2;
# Calculate variance components
Var_CTmaxF <- ((Mean_b0F)^2 / (Mean_b1F)^2) *
(Var_b0F/(Mean_b0F)^2 - (2 * Cov_b0F_b1F / (Mean_b0F * Mean_b1F)) + Var_b1F/(Mean_b1F)^2)
Var_zF <- Var_b1F / (Mean_b1F)^4
# Calculate heritability estimates
n_0
H2_CTmaxF <- Var_CTmaxF / (Var_CTmaxF + Var_zF + Var_eF / n_0)
H2_zF <- Var_zF / (Var_CTmaxF + Var_zF + Var_eF / n_0)
as.data.frame(t(data.frame(Var_b0F, Var_b1F, Cov_b0F_b1F, Var_eF, Var_CTmaxF, Var_zF, H2_CTmaxF, H2_zF)))
}
### Funcion Jacknife ####
jk=function(data,n_0,method,funcion){
if(funcion=="ancova"){
jk.all=ancova(data = data,n_0=n_0)
} else {if(funcion=="lme") jk.all=lme2(data=data,n_0=n_0,method=method) else {
print('Incorrect function specification. Must be either "ancova" or "lme"')}}
jk.i=do.call("cbind",lapply(unique(data$Genotype), function(i){
data.i=subset(data,Genotype!=i)
if(funcion=="ancova"){
ancova(data = data.i,n_0=n_0)
} else {if(funcion=="lme") lme2(data=data.i,n_0=n_0,method=method) else {
print('Incorrect function specification. Must be either "ancova" or "lme"')}}
}))
ndata=length(unique(data$Genotype))
pseudo.values=do.call("cbind",apply(jk.i,2,function(i) ndata*jk.all-(ndata-1)*i))
Jack_estimates=matrix(rowMeans(pseudo.values),nc=1)
#dv.i=do.call("cbind",apply(pseudo.values,1, function(i) i-jk.all))
dv.i=apply(pseudo.values,2, function(i) i-Jack_estimates)
SE=sqrt(rowSums(dv.i^2)/(ndata*(ndata-1)))
low = Jack_estimates - 2*SE;
up = Jack_estimates + 2*SE;
jk=(data.frame(Jacknife=Jack_estimates,low,up))
}
#### Aplica funciones hembras ####
#Hembras Ancova
females.ancova=ancova(data = Data_females,n_0=n_0Females)
females.jk.ancova=jk(data=Data_females,n_0=n_0Females,funcion = "ancova")
females.ancova=cbind(females.ancova,females.jk.ancova)
#Hembras ML
females.est.ML=lme2(data = Data_females,n_0=n_0Females,method="ML")
females.jk.ML=jk(data=Data_females,n_0=n_0Females,method="ML",funcion = "lme")
females.ML=cbind(females.est.ML,females.jk.ML)
#Hembras REML
females.est.REML=lme2(data = Data_females,n_0=n_0Females,method="REML")
females.jk.REML=jk(data=Data_females,n_0=n_0Females,method="REML",funcion="lme")
females.REML=cbind(females.est.REML,females.jk.REML)
#### Aplica funciones machos ####
#Machos Ancova
males.ancova=ancova(data = Data_males,n_0=n_0Males)
males.jk.ancova=jk(data=Data_males,n_0=n_0Males,funcion = "ancova")
males.ancova=cbind(males.ancova,males.jk.ancova)
#Machos ML
males.est.ML=lme2(data = Data_males,n_0=n_0Males,method="ML")
males.jk.ML=jk(data=Data_males,n_0=n_0Males,method="ML",funcion="lme")
males.ML=cbind(males.est.ML,males.jk.ML)
#Machos REML
males.est.REML=lme2(data = Data_males,n_0=n_0Males,method="REML")
males.jk.REML=jk(data=Data_males,n_0=n_0Males,method="REML",funcion="lme")
males.REML=cbind(males.est.REML,males.jk.REML)
# combine
ancova <- cbind(females.ancova, males.ancova)
ML     <- cbind(females.ML, males.ML)
REML   <- cbind(females.REML, males.REML)
names(ancova)
colnames(ancova) <- c("Female_estimate", "Females_Jacknife", "Females_low_95%_CI", "Females_up_95%_CI",
"Males_estimate", "Males_Jacknife", "Males_low_95%_CI", "Males_up_95%_CI")
ancova$Method <- "Anova"
names(ML)
colnames(ML) <- c("Female_estimate", "Females_Jacknife", "Females_low_95%_CI", "Females_up_95%_CI",
"Males_estimate", "Males_Jacknife", "Males_low_95%_CI", "Males_up_95%_CI")
ML$Method <- "ML"
names(REML)
colnames(REML) <- c("Female_estimate", "Females_Jacknife", "Females_low_95%_CI", "Females_up_95%_CI",
"Males_estimate", "Males_Jacknife", "Males_low_95%_CI", "Males_up_95%_CI")
REML$Method <- "REML"
# Combine and export to csv
Table_1 <- rbind(ancova, ML, REML)
# Combine and export to csv
Table_S1 <- rbind(ancova, ML, REML)
# Combine and export to csv
Table_S1 <- rbind(ancova, ML, REML)
View(Table_S1)
# Combine and export to csv
Table_S1 <- rbind(ancova, ML, REML)
write.csv(Table_S1, "../Outputs/Estimates of variance-covariance components and broad-sense heritability DGRP lines (Table_S1).csv", row.names = TRUE)
